<div class="create-group-container fade-in">
  <div class="page-header">
    <button class="btn-back" routerLink="/dashboard">
      <i class="bi bi-arrow-left"></i> Volver
    </button>
    <h1>
      <i class="bi bi-people-fill"></i> Crear Nuevo Grupo
    </h1>
  </div>

  <div class="form-container">
    <div *ngIf="successMessage()" class="alert alert-success">
      <i class="bi bi-check-circle-fill"></i> {{ successMessage() }}
    </div>
    
    <div *ngIf="errorMessage()" class="alert alert-danger">
      <i class="bi bi-exclamation-triangle-fill"></i> {{ errorMessage() }}
    </div>

    <form [formGroup]="groupForm" (ngSubmit)="onSubmit()" class="group-form">
      <div class="form-group">
        <label for="name" class="form-label">
          <i class="bi bi-tag"></i> Nombre del Grupo
        </label>
        <input 
          id="name" 
          type="text" 
          class="form-control" 
          formControlName="name"
          placeholder="Ej: Equipo de Marketing">
        <div *ngIf="groupForm.get('name')?.invalid && groupForm.get('name')?.touched" class="error-message">
          <span *ngIf="groupForm.get('name')?.errors?.['required']">El nombre es obligatorio</span>
          <span *ngIf="groupForm.get('name')?.errors?.['minlength']">El nombre debe tener al menos 3 caracteres</span>
        </div>
      </div>

      <div class="form-group">
        <label for="description" class="form-label">
          <i class="bi bi-card-text"></i> Descripci贸n
        </label>
        <textarea 
          id="description" 
          class="form-control" 
          formControlName="description"
          rows="3"
          placeholder="Describe el prop贸sito de este grupo..."></textarea>
        <div *ngIf="groupForm.get('description')?.invalid && groupForm.get('description')?.touched" class="error-message">
          <span *ngIf="groupForm.get('description')?.errors?.['required']">La descripci贸n es obligatoria</span>
          <span *ngIf="groupForm.get('description')?.errors?.['minlength']">La descripci贸n debe tener al menos 10 caracteres</span>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">
          <i class="bi bi-people"></i> Agregar Miembros (Opcional)
        </label>
        <p class="help-text">Selecciona los usuarios que quieres agregar al grupo</p>
        
        <div *ngIf="loadingUsers()" class="loading-users">
          <div class="spinner-border spinner-border-sm text-primary"></div>
          <span>Cargando usuarios...</span>
        </div>

        <div *ngIf="!loadingUsers() && users().length" class="users-selector">
          <div 
            *ngFor="let user of users()" 
            class="user-option"
            [class.selected]="isUserSelected(user.id || '')"
            (click)="toggleUserSelection(user.id || '')">
            <div class="user-option-info">
              <i class="bi bi-person-circle"></i>
              <div class="user-details">
                <span class="user-name">{{ user.username }}</span>
                <span class="user-email">{{ user.email }}</span>
              </div>
            </div>
            <div class="user-option-checkbox">
              <i class="bi" [ngClass]="isUserSelected(user.id || '') ? 'bi-check-circle-fill' : 'bi-circle'"></i>
            </div>
          </div>
        </div>

        <div *ngIf="!loadingUsers() && !users().length" class="no-users">
          <i class="bi bi-inbox"></i>
          <p>No hay usuarios disponibles</p>
        </div>

        <div *ngIf="selectedUserIds().length" class="selected-count">
          <i class="bi bi-check2-circle"></i>
          {{ selectedUserIds().length }} usuario(s) seleccionado(s)
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-secondary" routerLink="/dashboard" [disabled]="isSubmitting()">
          Cancelar
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="groupForm.invalid || isSubmitting()">
          <span *ngIf="!isSubmitting()">
            <i class="bi bi-plus-circle"></i> Crear Grupo
          </span>
          <span *ngIf="isSubmitting()">
            <span class="spinner-border spinner-border-sm me-2"></span> Creando...
          </span>
        </button>
      </div>
    </form>
  </div>
</div>
